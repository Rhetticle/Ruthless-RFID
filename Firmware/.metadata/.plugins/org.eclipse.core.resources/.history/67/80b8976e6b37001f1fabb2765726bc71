/*
 * commands.c
 *
 *  Created on: 30 Jun. 2024
 *      Author: rhett
 */

#include "commands.h"
#include "ruthlessfs.h"
#include "stm32f4xx.h"
#include <stdint.h>
#include <string.h>
#include <stdio.h>

CMD_StatusTypeDef cmd_ls () {
	char** file_names = malloc(get_number_files_section(0, 3) * sizeof(char*));
	if (get_files_section(file_names, 0, 3) != RFS_OK) {
		return CMD_LS_ERROR;
	}

	for (int i = 0; i < 2; i++) {
		printf("\n\r%s", file_names[i]);
	}
	free_filenames(file_names, 2);
	return CMD_OK;
}

CMD_StatusTypeDef cmd_parse(char* cmd) {
	if (strcmp(cmd, "ls") == 0) {
		cmd_ls();
	} else {
		printf("\n\rcommand not found: %s", cmd);
	}

}

void cmd_build(char** current, char input) {
	uint8_t length;

	if (*current == NULL) {
		length = 0;
	} else {
		length = strlen(current);
	}

	*current = realloc(current, length + 2);
	(*current)[length] = input;
	(*current)[length + 1] = '\0';
}
