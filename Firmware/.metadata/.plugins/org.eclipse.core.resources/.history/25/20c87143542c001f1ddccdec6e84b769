/*
 * ruthlessfs.c
 *
 *  Created on: 17 Jun. 2024
 *      Author: rhett
 */

/**
 * ******************************Ruthless File System***********************************
 *
 * File system used by Ruthless RFID to store data of read cards. Each entry occupies a 128kB block (smallest erasable block size).
 *
 * Page 1 - Metadata
 * Page 2 - Card name and type
 * Page 3 - Contents
 * */
#include "stm32f4xx.h"
#include "W25N01GVZEIG.h"
#include "ruthlessfs.h"
#include <string.h>

/**
 * Enter a card into the file system
 *
 * @param card - Card to store
 * @return RFS_OK if card was successfully stored
 * */
RFS_StatusTypeDef enter_card(Card* card) {
	uint16_t free_block = (uint16_t)mem_find_free_block();
	uint8_t card_size = sizeof(card->contents)/sizeof(card->contents[0]);
	int read_protected = card->read_protected;
	uint8_t* metadata = malloc(sizeof(card_size)+sizeof(read_protected)+strlen(card->type));
	MEM_WRITE(free_block, 0x0000, &card_size, 1);

}
